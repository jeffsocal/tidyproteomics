<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidyproteomics: simplified data object and analysis functions
">
<title>Normalizing • tidyproteomics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Normalizing">
<meta property="og:description" content="tidyproteomics: simplified data object and analysis functions
">
<meta property="og:image" content="https://jeffsocal.github.io/tidyproteomics/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyproteomics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/updates.html">Updates</a>
    <a class="dropdown-item" href="../articles/data-object.html">The Data-Object</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Operations</h6>
    <a class="dropdown-item" href="../articles/importing.html">Importing</a>
    <a class="dropdown-item" href="../articles/summarizing.html">Summarizing</a>
    <a class="dropdown-item" href="../articles/subsetting.html">Subsetting</a>
    <a class="dropdown-item" href="../articles/normalizing.html">Normalizing</a>
    <a class="dropdown-item" href="../articles/imputing.html">Imputing</a>
    <a class="dropdown-item" href="../articles/annotating.html">Annotating</a>
    <a class="dropdown-item" href="../articles/collapsing.html">Protein Accounting</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Analysis</h6>
    <a class="dropdown-item" href="../articles/visualizing.html">Visualizing</a>
    <a class="dropdown-item" href="../articles/expression.html">Expression</a>
    <a class="dropdown-item" href="../articles/enrichment.html">Enrichment</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Workflows</h6>
    <a class="dropdown-item" href="../articles/workflow-simple.html">Simple</a>
    <a class="dropdown-item" href="../articles/workflow-importing.html">Importing Demo</a>
    <a class="dropdown-item" href="../articles/workflow-userimport.html">User Defined Import</a>
    <a class="dropdown-item" href="../articles/workflow-publication.html">Publication Demo</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Normalizing</h1>
            
      
      
      <div class="d-none name"><code>normalizing.Rmd</code></div>
    </div>

    
    
<p>Quantitative proteomics relies on accurate normalization, for which
several choices are available, yet remain somewhat difficult to
accurately implement or require formatting data differently for each.
For example, a simple alignment of measured median’s requires only a few
lines of code, while implementing normalization from the
<strong><em>limma</em></strong> package requires non-intuitive
formatting of the data. The <code><a href="../reference/normalize.html">normalize()</a></code> function is
designed as a wrapper to handle various methods of normalization all at
once, then allowing researchers the ability to examine the result and
choose the method best suited for their analysis. Alternatively, the
<code><a href="../reference/select_normalization.html">select_normalization()</a></code> function can automatically select
the best normalization based on a weighted score combining CVs, dynamic
range and variability in the first three PCA components, or the user can
override this selection manually. The values from the selected
normalization are then use for all downstream plots and analyses such as
<code><a href="../reference/expression.html">expression()</a></code> and <code><a href="../reference/enrichment.html">enrichment()</a></code>.</p>
<p>Normalization in tidyproteomics attempts to apply each function
universally, meaning the same towards peptide and protein values. To do
this each data-object contains a variable called the
<code>identifier</code> , this tells the underlying helper functions
what values in the quantitative table “identify” the thing being
measured.</p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidyproteomics'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expression, merge, subset</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.2 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2</span> 3.4.2      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr  </span> 1.0.0 </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble </span> 3.1.8      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr  </span> 1.0.10</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr  </span> 1.2.1      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr</span> 1.5.0 </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr  </span> 2.1.3      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats</span> 0.5.2 </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">ggplot2</span>::<span style="color: #00BB00;">annotate()</span> masks <span style="color: #0000BB;">tidyproteomics</span>::annotate()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">collapse()</span>   masks <span style="color: #0000BB;">tidyproteomics</span>::collapse()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyr</span>::<span style="color: #00BB00;">extract()</span>    masks <span style="color: #0000BB;">tidyproteomics</span>::extract()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>     masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>        masks <span style="color: #0000BB;">stats</span>::lag()</span></span></code></pre>
<p>Proteins have a single identifier …</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hela_proteins</span><span class="op">$</span><span class="va">identifier</span></span>
<span><span class="co">#&gt; [1] "protein"</span></span>
<span><span class="va">hela_proteins</span><span class="op">$</span><span class="va">quantitative</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   sample_id sample    replicate protein abundance_raw</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> e9b20ea7  control   1         Q15149    <span style="text-decoration: underline;">1</span>011<span style="text-decoration: underline;">259</span>992.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ef79cc4c  control   2         Q15149    <span style="text-decoration: underline;">1</span>093<span style="text-decoration: underline;">277</span>593.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> eebba67b  control   3         Q15149     980<span style="text-decoration: underline;">809</span>516.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ebf4b0fe  knockdown 1         Q15149    <span style="text-decoration: underline;">1</span>410<span style="text-decoration: underline;">445</span>367.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ea36dac9  knockdown 2         Q15149    <span style="text-decoration: underline;">1</span>072<span style="text-decoration: underline;">305</span>561.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ecfd1822  knockdown 3         Q15149    <span style="text-decoration: underline;">1</span>486<span style="text-decoration: underline;">561</span>518.</span></span></code></pre></div>
<p>Peptides have multiple identifiers …</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hela_peptides</span><span class="op">$</span><span class="va">identifier</span></span>
<span><span class="co">#&gt; [1] "protein"       "peptide"       "modifications"</span></span>
<span><span class="va">hela_peptides</span><span class="op">$</span><span class="va">quantitative</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   sample_id sample  replicate protein peptide               modificati…¹ abund…²</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> aaf7e768  control 1         P06576  IPSAVGYQPTLATDMGTMQER <span style="color: #BB0000;">NA</span>            4.32<span style="color: #949494;">e</span>7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> aaf7e768  control 1         P06576  IPSAVGYQPTLATDMGTMQER 1xOxidation…  1.47<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> aaf7e768  control 1         Q9P2E9  LTAEFEEAQTSACR        1xCarbamido…  5.90<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> aaf7e768  control 1         P11021  ITPSYVAFTPEGER        <span style="color: #BB0000;">NA</span>            5.29<span style="color: #949494;">e</span>7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> aaf7e768  control 1         P11021  IINEPTAAAIAYGLDK      <span style="color: #BB0000;">NA</span>            2.45<span style="color: #949494;">e</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> aaf7e768  control 1         Q9P2E9  LLATEQEDAAVAK         <span style="color: #BB0000;">NA</span>            5.83<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​modifications, ²​abundance_raw</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="normalization-functions">Normalization Functions<a class="anchor" aria-label="anchor" href="#normalization-functions"></a>
</h3>
<p>Normalization currently supports the methods described below.</p>
<blockquote>
<p><em>Benchmark timing was accomplished on an M1 MacBook Pro (macOS
Ventura 13.3 22E252). Parallel processing for both
<code>randomforest</code> and <code>svm</code> are accomplished using
<code>mclapply</code> from the R parallel package.</em></p>
</blockquote>
<table style="width:99%;" class="table">
<colgroup>
<col width="16%">
<col width="51%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Description</th>
<th>Timing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>scaled</td>
<td>values are aligned medians and dynamic ranges to adjusted to be
similar</td>
<td>0.3 sec</td>
</tr>
<tr class="even">
<td>median</td>
<td>values are simply aligned to the same median value</td>
<td>0.3 sec</td>
</tr>
<tr class="odd">
<td>linear</td>
<td>a linear regression is applied to each data set according to
individual analyte means</td>
<td>0.2 sec</td>
</tr>
<tr class="even">
<td>limma</td>
<td>wrapper to the limma package</td>
<td>0.4 sec</td>
</tr>
<tr class="odd">
<td>loess</td>
<td>a non-linear loess (quantile) regression applied to each data set
according to individual analyte means</td>
<td>1.3 sec</td>
</tr>
<tr class="even">
<td>svm</td>
<td>a non-linear regression (support vector machine) applied to each
data set according to individual analyte means. This implementation
utilizes eps-regression from the e1071 package and tuning of the gama
and cost parameters.</td>
<td>
<p>5min &amp; 52.1 sec</p>
<p>2min &amp; 26.5 sec (4 cores)</p>
</td>
</tr>
<tr class="odd">
<td>randomforest</td>
<td>a non-linear random forest regression applied to each data set
according to individual analyte means.</td>
<td>
<p>37.8 sec</p>
<p>14.0 sec (4 cores)</p>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://jeffsocal.github.io/tidyproteomics/">"tidyproteomics"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="normalization-of-the-whole-proteome">Normalization of the whole proteome<a class="anchor" aria-label="anchor" href="#normalization-of-the-whole-proteome"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># path_to_package_data() loads data specific to this package</span></span>
<span><span class="co"># for your project load local data</span></span>
<span><span class="co"># example: </span></span>
<span><span class="co"># your_proteins &lt;- "./data/your_exported_results.xlsx" %&gt;%</span></span>
<span><span class="co">#   import("ProteomeDiscoverer", "proteins")</span></span>
<span></span>
<span><span class="va">rdata</span> <span class="op">&lt;-</span> <span class="va">hela_proteins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span>.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scaled"</span>, <span class="st">"median"</span>, <span class="st">"linear"</span>, <span class="st">"loess"</span>, <span class="st">"randomforest"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing">Visualizing<a class="anchor" aria-label="anchor" href="#visualizing"></a>
</h3>
<p>Plotting the overall variation and dynamic range. It is easy to
reduce variability simply by squashing the dynamic range - plotting that
here can ensure that does not happen. Keep in mind that the overall
dynamic range for several mis-aligned sets will be smaller when properly
normalized - often <em>median</em> normalization has an immediate impact
on the CVs and is the least rigorous. Note here the dramatic reduction
in CVs <em>randomforest</em> yielded while also maintaining the overall
dynamic range.</p>
<div class="section level4">
<h4 id="cvs-and-dynamic-range">CVs and Dynamic Range<a class="anchor" aria-label="anchor" href="#cvs-and-dynamic-range"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_variation_cv.html">plot_variation_cv</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="normalizing_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="pca">PCA<a class="anchor" aria-label="anchor" href="#pca"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_variation_pca.html">plot_variation_pca</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="normalizing_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="effect-of-normalization-on-dynamic-range">Effect of Normalization on Dynamic Range<a class="anchor" aria-label="anchor" href="#effect-of-normalization-on-dynamic-range"></a>
</h4>
<p>The effect <em>randomforest</em> has on the data is most noticable at
the lower dynamic range, as seen in the plot below where the CVs for
values under 10^6 in abundance have been dramatically reduced. If you
are hunting for low abundant biomarkers, this method is highly
recomended.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hela_proteins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span>.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'median'</span>, <span class="st">'randomforest'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_dynamic_range.html">plot_dynamic_range</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="normalizing_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="normalization-based-on-a-subset">Normalization based on a subset<a class="anchor" aria-label="anchor" href="#normalization-based-on-a-subset"></a>
</h3>
<p>In addition to proteome wide normalization, a subset can be used as
the basis for normalization, such as the case for spike-in quantitative
analytes or the perhaps the bait protein in an immunoprecipitation
experiment. This is accomplished with the same semantic syntax as with
the <code><a href="../reference/subset.html">subset()</a></code> function and is reflected in the recorded
operations. Be aware that using a regression from a smaller dynamic
range than the full proteome may not predict well beyond the limts of
the subset.</p>
<p>NOTE: while <em>linear</em> and <em>svm</em> can predict beyond the
training set limits, <em>loess</em> can not.</p>
<p>NOTE: The <em>randomforest</em> normalization method, as implemented,
requires the the prediction set size to match the training test size,
and therefore is only applicable to normalization of the whole proteome.
The <em>limma</em> normalization method also does not accept a subset
for normalization. Both of these methods will be skipped if a subset is
implemented.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdata</span> <span class="op">&lt;-</span> <span class="va">hela_proteins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span><span class="va">description</span> <span class="op"><a href="../reference/grapes-like-grapes.html">%like%</a></span> <span class="st">'ribosome'</span>,</span>
<span>            .method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'median'</span>, <span class="st">'linear'</span>, <span class="st">'loess'</span>, <span class="st">'svm'</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">rdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_variation_cv.html">plot_variation_cv</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="normalizing_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_dynamic_range.html">plot_dynamic_range</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="normalizing_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/operations.html">operations</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Data Transformations</span></span>
<span><span class="co">#&gt;   • Data files (p97KD_HCT116_proteins.xlsx) were imported as proteins from</span></span>
<span><span class="co">#&gt;   ProteomeDiscoverer</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   • Data reassigned sample to control where 'sample like ctl'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   • Data reassigned sample to knockdown where 'sample like p97'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   • Data normalized via median, linear, loess, svm.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   • Data normalized using subset description %like% ribosome FALSE.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   • ... based on a subset of 17 out of 5346 identifiers</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   • Normalization automatically selected as loess.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="developing-additional-methods">Developing Additional Methods<a class="anchor" aria-label="anchor" href="#developing-additional-methods"></a>
</h3>
<p>The normalization function can accommodate new methods fairly easily,
but not without being tested and integrated with the package as a whole.
This is due to the serial deployment of each normalization method and
subsequent selection of the best method going forward. That could change
in the future. For now lets walk through the process of adding a new
method. And as always, reach out the the maintainers to have your method
added to the package for others to use.</p>
<div class="section level4">
<h4 id="where-the-normalization-gets-called">Where the normalization gets called<a class="anchor" aria-label="anchor" href="#where-the-normalization-gets-called"></a>
</h4>
<p>In the code base locate the file
<code>R &gt; control_normalization.R</code>, this is where the method
gets applied. Note, near the bottom, the <code>if()</code> statements,
specifically for <code>median</code>, this is where median normalization
gets implemented.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## d:        the raw data for all samples</span></span>
<span><span class="co">## dc_this:  the 'centered' data</span></span>
<span><span class="co">## d_norm:   the output normalized data</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="st">'median'</span><span class="op">)</span> <span class="op">{</span>         <span class="va">d_norm</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/normalize_median.html">normalize_median</a></span><span class="op">(</span><span class="va">dc_this</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>All normalization functions require two inputs, a table of all the
raw values log2 transformed, and a table of grouped and ‘centered’
values to normalize against. This table can either be computed from the
entire proteome or from a subset as demonstrated above.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">## the log2 raw values</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># A tibble: 30,157 × 4</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>   sample    replicate identifier abundance</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a> <span class="dv">1</span> control   <span class="dv">1</span>         Q15149          <span class="fl">29.9</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a> <span class="dv">2</span> control   <span class="dv">2</span>         Q15149          <span class="fl">30.0</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a> <span class="dv">3</span> control   <span class="dv">3</span>         Q15149          <span class="fl">29.9</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a> <span class="dv">4</span> knockdown <span class="dv">1</span>         Q15149          <span class="fl">30.4</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a> <span class="dv">5</span> knockdown <span class="dv">2</span>         Q15149          <span class="fl">30.0</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a> <span class="dv">6</span> knockdown <span class="dv">3</span>         Q15149          <span class="fl">30.5</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a> ...</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="the-normalization-function">The normalization function<a class="anchor" aria-label="anchor" href="#the-normalization-function"></a>
</h4>
<p>For the median normalization method, all samples will be adjusted
such that their medians are aligned. Therefor, we need to take the
median value of each sample, and the median of the medians, such that
they all align.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normalize_median</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">data_centered</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># visible bindings</span></span>
<span>  <span class="va">abundance</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>  <span class="co"># compute the median shift</span></span>
<span>  <span class="va">data_centered</span> <span class="op">&lt;-</span> <span class="va">data_centered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span> <span class="op">-</span> <span class="va">abundance</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># apply the median shift and return the data</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data_centered</span>,</span>
<span>              by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sample'</span>,<span class="st">'replicate'</span><span class="op">)</span>,</span>
<span>              suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"_median"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>abundance_normalized <span class="op">=</span> <span class="va">abundance</span> <span class="op">+</span> <span class="va">shift</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">identifier</span>, <span class="va">sample</span>, <span class="va">replicate</span>, <span class="va">abundance_normalized</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="normalized-data-gets-merged-on-return">Normalized data gets merged on return<a class="anchor" aria-label="anchor" href="#normalized-data-gets-merged-on-return"></a>
</h4>
<p>The data, upon return to the controller function, has the abundance
values converted back to non-log values, and merged into the main data
object such that all abundance values are avaiable for future
selection.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>d_norm <span class="ot">&lt;-</span> d_norm <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">abundance_normalized =</span> <span class="fu">invlog2</span>(abundance_normalized)) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">abundance =</span> abundance_normalized)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">merge_quantitative</span>(d_norm, m)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>    </span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># A tibble: 42,330 × 6</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>   sample_id sample    replicate protein abundance_raw abundance_median</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>           <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>            <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a> <span class="dv">1</span> e9b20ea7  control   <span class="dv">1</span>         Q15149    <span class="fl">1011259992.</span>       <span class="fl">999619474.</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a> <span class="dv">2</span> ef79cc4c  control   <span class="dv">2</span>         Q15149    <span class="fl">1093277593.</span>      <span class="fl">1106008756.</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a> <span class="dv">3</span> eebba67b  control   <span class="dv">3</span>         Q15149     <span class="fl">980809516.</span>      <span class="fl">1094113651.</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a> <span class="dv">4</span> ebf4b0fe  knockdown <span class="dv">1</span>         Q15149    <span class="fl">1410445367.</span>      <span class="fl">1062933343.</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a> <span class="dv">5</span> ea36dac9  knockdown <span class="dv">2</span>         Q15149    <span class="fl">1072305561.</span>      <span class="fl">1113989578.</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a> <span class="dv">6</span> ecfd1822  knockdown <span class="dv">3</span>         Q15149    <span class="fl">1486561518.</span>      <span class="fl">1076375880.</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a> <span class="dv">7</span> e9b20ea7  control   <span class="dv">1</span>         Q09666     <span class="fl">659299359.</span>       <span class="fl">651710227.</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a> <span class="dv">8</span> ef79cc4c  control   <span class="dv">2</span>         Q09666     <span class="fl">717783135.</span>       <span class="fl">726141683.</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a> <span class="dv">9</span> eebba67b  control   <span class="dv">3</span>         Q09666     <span class="fl">612673576.</span>       <span class="fl">683450264.</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="dv">10</span> ebf4b0fe  knockdown <span class="dv">1</span>         Q09666    <span class="fl">1000041657.</span>       <span class="fl">753646788.</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hela_proteins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span>.method <span class="op">=</span> <span class="st">'median'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_normalization.html">plot_normalization</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Normalizing quantitative data</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ... using <span style="color: #0000BB;">median shift</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ... using <span style="color: #0000BB;">median shift</span> <span style="color: #B2B2B2;">[153ms]</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Selecting best normalization method</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Selecting best normalization method ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span>  ... selected <span style="color: #0000BB; font-style: italic;">median</span></span></span></code></pre></div>
<p><img src="normalizing_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>Check out some of the other normalization functions to see how they
are implemented.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jeff Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
