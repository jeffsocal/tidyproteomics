---
title: "Expression"
output: rmarkdown::html_vignette
description: |
  tidyproteomics: simplified data object and analysis functions
vignette: >
  %\VignetteIndexEntry{Expression}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
set.seed(1041)
options(dplyr.print_max = 10)
```

### Analysis of Two Samples

One of the most fundamental analyses for quantitative proteomics is the
estimation of univariate differences between two samples. Tidyproteomics
accommodates two sample analysis using the `expression()` function, the
results of which can be visualized using the `plot_volcano()` and
`plot_proportion()` visualization functions as shown below. The
expression analysis can be accomplished thought the R *limma* package,
or using any two-sample statistical comparison, the default method
employs the two-sided T-test. Note, if no values pass the cutoff it will
automatically choose the top proteins to display.

It should be noted that this package does not incorporate some of the
more recent methods described in literature. These methods could be
incorporated in future revisions, or through a user provided function.

+---------+------------------------------------------------------------+
| MSstats | Choi, Meena, Ching-Yun Chang, Timothy Clough, Daniel       |
|         | Broudy, Trevor Killeen, Brendan MacLean, and Olga Vitek.   |
|         | 2014. \"MSstats: An R Package for Statistical Analysis of  |
|         | Quantitative Mass Spectrometry-Based Proteomic             |
|         | Experiments.\" *Bioinformatics* 30 (17): 2524--26.         |
|         |                                                            |
|         | [msstats.org](msstats.org)                                 |
+---------+------------------------------------------------------------+
| DEqMS   | Zhu, Yafeng, Lukas M. Orre, Yan Zhou Tran, Georgios        |
|         | Mermelekas, Henrik J. Johansson, Alina Malyutina, Simon    |
|         | Anders, and Janne Lehti√∂. 2020. \"DEqMS: A Method for      |
|         | Accurate Variance Estimation in Differential Protein       |
|         | Expression Analysis.\" *Molecular & Cellular Proteomics:   |
|         | MCP* 19 (6): 1047--57.                                     |
|         |                                                            |
|         | [Bioconductor:                                             |
|         | DEqMS](https://w                                           |
|         | ww.bioconductor.org/packages/release/bioc/html/DEqMS.html) |
+---------+------------------------------------------------------------+
| MS      | Ammar, Constantin, Markus Gruber, Gergely Csaba, and Ralf  |
| -EmpiRe | Zimmer. 2019. \"MS-EmpiRe Utilizes Peptide-Level Noise     |
|         | Distributions for Ultra-Sensitive Detection of             |
|         | Differentially Expressed Proteins.\" *Molecular & Cellular |
|         | Proteomics: MCP* 18 (9): 1880--92.                         |
|         |                                                            |
|         | [GitHub:MS-EmpiRe](https://github.com/zimmerlab/MS-EmpiRe) |
+---------+------------------------------------------------------------+
| meqrob  | Sticker, Adriaan, Ludger Goeminne, Lennart Martens, and    |
|         | Lieven Clement. 2020. \"Robust Summarization and Inference |
|         | in Proteome-Wide Label-Free Quantification.\" *Molecular & |
|         | Cellular Proteomics: MCP* 19 (7): 1209--19.                |
|         |                                                            |
|         | [Bioconductor:                                             |
|         | msqrob2](https://www                                       |
|         | .bioconductor.org/packages/release/bioc/html/msqrob2.html) |
+---------+------------------------------------------------------------+

```{r, message = FALSE}

```

+--------------+-----------------------+---------------+--------------+
| parameter    | description           | inputs        | default      |
+==============+=======================+===============+==============+
| log2fc_min   | the minimum cutoff    | *0 to Inf*    | *2*          |
|              | for displaying        |               |              |
+--------------+-----------------------+---------------+--------------+
| signifi      | the column to use for | *             | *a           |
| cance_column | significance          | adj_p\_value, | dj_p\_value* |
|              |                       | p_value*      |              |
+--------------+-----------------------+---------------+--------------+
| sign         | the minimum cutoff    | *1 to 1/Inf*  | *0.05*       |
| ificance_max | for displaying        |               |              |
+--------------+-----------------------+---------------+--------------+
| l            | how to label the      | any value in  | *protein*    |
| abels_column | points                | annotations,  |              |
|              |                       | eg            |              |
|              |                       | *gene_name,   |              |
|              |                       | description*  |              |
+--------------+-----------------------+---------------+--------------+
| show_pannels | show the colored      | *TRUE /       | *TRUE*       |
|              | areas highlighting    | FALSE*        |              |
|              | significance          |               |              |
+--------------+-----------------------+---------------+--------------+
| show_lines   | show the dotted       | *TRUE /       | *TRUE*       |
|              | cutoff lines          | FALSE*        |              |
+--------------+-----------------------+---------------+--------------+
| s            | show the second scale | *TRUE /       | *TRUE*       |
| how_fc_scale | on top converting     | FALSE*        |              |
|              | *log2_foldchange* to  |               |              |
|              | *foldchange*          |               |              |
+--------------+-----------------------+---------------+--------------+
| point_size   | size of each dot      | *1/10* to *5* | *NULL*       |
+--------------+-----------------------+---------------+--------------+
| co           | color for positive    | [any R        | *dodgerblue* |
| lor_positive | expression            | accepts](htt  |              |
|              |                       | ps://r-charts |              |
|              |                       | .com/colors/) |              |
+--------------+-----------------------+---------------+--------------+
| co           | color for negative    | [any R        | *firebrick1* |
| lor_negative | expression            | accepts](htt  |              |
|              |                       | ps://r-charts |              |
|              |                       | .com/colors/) |              |
+--------------+-----------------------+---------------+--------------+

```{r, message=FALSE}
library("dplyr")
library("tidyproteomics")

rdata <- hela_proteins %>% 
  normalize(.method = 'loess') %>%
  impute(impute_function = base::min) %>%
  expression(knockdown/control)
```

#### Exporting Results

The results of this analysis are stored in the tidyproteomics
data-object and can easily be exported to save as a flat data table or
used in an external down stream analysis.

```{r}

rdata %>% export_analysis(knockdown/control, .analysis = 'expression')
```

#### Volcano Plot

The default is to plot accoring to adjusted p-value with a Log2
fold-change cutoff of 2 or greater.

```{r}

rdata %>% plot_volcano(knockdown/control)
```

The parameters can be adjusted to suit your needs ...

```{r}

rdata %>% plot_volcano(knockdown/control,
                       significance_column = 'p_value',
                       significance_max = 0.01,
                       log2fc_min = 2)
```

... or desires.

```{r}
library(ggplot2)

rdata %>% plot_volcano(knockdown/control,
                       significance_column = 'p_value',
                       significance_max = 0.01,
                       log2fc_min = 2,
                       color_positive = 'orange',
                       color_negative = 'purple',
                       show_lines = FALSE,
                       show_fc_scale = FALSE,
                       show_pannels = FALSE,
                       labels_column = 'gene_name') +
  labs(title = "A nice volcano plot", subtitle = "with great colors")
```

#### Proportional Plot

The proportional plot is complementary to the volcano plot and utilizes
all the same underlying data. The default is to show both the top 1%
(`proportion_min = 0.01`) along with the values passing the fold-change
and significance cutoffs.

```{r, message=FALSE}
library(ggplot2)

rdata %>% plot_proportion(knockdown/control)
```

This plot can likewise also be manipulated like the volcano plot.

```{r}
library(ggplot2)

rdata %>% plot_proportion(knockdown/control,
                       significance_column = 'p_value',
                       proportion_min = 0.1,
                       log2fc_min = 2,
                       color_positive = 'orange',
                       color_negative = 'purple',
                       show_lines = TRUE,
                       labels_column = 'gene_name')

```
